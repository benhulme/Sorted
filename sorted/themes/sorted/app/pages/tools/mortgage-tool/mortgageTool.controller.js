!function(){"use strict";angular.module("sorted").controller("MortgageToolController",["$scope","siteConfig","MortgageToolModel","$window","$routeParams","isLoggedIn","pageData","calcData","$analytics",function(a,t,e,o,c,l,n,r,u){function i(){var t=[],c=new o.SortedCalculator_Mortgage_Manager,l=new o.SortedCalculator_Mortgage_Repayment;return _.forEach(a.calculator.inputs,function(e){var o={};_.forEach(a.calculator.fields,function(a){a.calcModel&&(o[a.calcModel]=a.value)}),_.merge(o,_.pick(e,["id","unique","title"])),t.push(o)}),new e({models:t,CalcID:a.calculator.CalcID},{parse:!0,mortgageRepayment:l,mortgageManager:c})}a.siteConfig=t,a.data=n.data[0],a.calculator=r.data,a.resultsInteraction=!1,a.interaction=!1,a.loadChange=0,a.validation={},a.model=function(){return _.isEmpty(a.model)?i():a.model}(),a.model.collection.on("change",function(t){a.loadChange>0?a.interaction||(u.eventTrack("startinteraction",{category:"calculators",label:"Mortgage"}),a.interaction=!0):a.loadChange++;try{t.calculate().hasResult()&&(console.log("result!"),a.resultsInteraction||(u.eventTrack("resultscalculated",{category:"calculators",label:"Mortgage"}),a.resultsInteraction=!0),a.$broadcast("output:update",t.collection.indexOf(t)))}catch(a){console.error("calculation failed ",a)}}),a.$on("input:changed",function(t,e){a.$broadcast("output:update",e)}),_.has(c,"id")&&l&&a.model.set({ID:_.toString(c.id)},{silent:!0}).fetch({parse:!0,success:function(){a.$broadcast("output:update",0)}})}])}();