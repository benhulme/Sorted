!function(){"use strict";angular.module("sorted").controller("DebtCalculatorController",["$scope","siteConfig","silverStripeService","calcInputService","$q","$rootScope","debtCalculatorModel","Profile","calcService","pageData","calcData","isLoggedIn","$routeParams","$analytics",function(a,e,l,c,t,o,d,r,n,i,u,s,m,f){a.siteConfig=e,a.debtCalculatorModel=d,a.calcTitle=null,a.loadId=null,a.interaction=!1,a.resultsInteraction=!1,a.loadChange=0,a.sliderOptions={floor:0,ceil:1e3,showSelectionBar:!0};var p=new SortedCalculator_Debt;a.updateCurrentModel=function(e,l){a.model=a.models[l],a.unique=l,a.formType=e,a.$digest()},a.runCalculation=function(e){var l,c,t;switch(a.formType){case"creditCard":l={cc:{cc1:e.data}},c=p.calculate(l),t=c.cc.cc1;break;case"hirePurchase":l={hp:{hp1:e.data}},c=p.calculate(l),t=c.hp.hp1;break;case"carLoan":l={cl:{cl1:e.data}},c=p.calculate(l),t=c.cl.cl1;break;case"personalLoan":l={pl:{pl1:e.data}},c=p.calculate(l),t=c.pl.pl1}return t},a.$watch("models",function(){if(a.model){a.loadChange>2?a.interaction||(f.eventTrack("startinteraction",{category:"calculators",label:"debt Calc"}),a.interaction=!0):a.loadChange++;var e=a.model.prepare(a.model.fields);e.ready?(console.log("recalc"),a.model.result=a.runCalculation(e),a.model.result.result_total?(a.resultsInteraction||(f.eventTrack("resultscalculated",{category:"calculators",label:"debt Calc"}),a.resultsInteraction=!0),a.model.ready=!0):(a.model.ready=!1,a.model.result={})):(a.model.ready=!1,a.model.result={})}},!0),a.createModels=function(e){var l={};return angular.forEach(e,function(e){var c=a[e.model];angular.forEach(e.inputs,function(t){l[t.unique]=c.getInstance(e),a.model||(a.formType=e.type,a.model=l[t.unique],a.unique=t.unique)})}),l},a.digestCalc=function(){a.$digest()},a.$on("save:calc",function(e,l){var c=n.prepare(a.models),t={CalcID:a.data.CalcID,Data:c,Title:l};a.calcTitle=l,a.loadedId?(t.ID=a.loadedId,n.update(t,a.loadedId).then(a.calcSaved,a.calcSavedFailed)):n.save(t).then(a.calcSaved,a.calcSavedFailed)}),a.calcSaved=function(e){angular.element("#save-as-modal").modal("hide"),a.loadId=e.data.ID},a.calcSavedFailed=function(a){console.error("failed ",a)},a.loadCalc=function(e){a.models=n.load(a.models,e.data.data.Data)},a.loadCalcFailed=function(a){console.error("failed ",a)},a.data=i.data[0],a.calculator=u.data,a.models=a.createModels(a.calculator),m.id&&s&&(a.loadedId=m.id,n.get(a.loadedId).then(a.loadCalc,a.loadCalcFailed))}])}();