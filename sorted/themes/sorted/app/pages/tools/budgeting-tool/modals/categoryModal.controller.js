!function(){"use strict";angular.module("budgetingTool").controller("CategoryModalCtrl",["$scope","$log","$q","$uibModalInstance","budgetModal","budgetingToolConfig","Category","periodAmount","Profile","siteConfig","categoryModel","masterCategoryModel",function(e,o,t,a,r,n,g,c,i,l,y,s){function u(o){o&&(e.category.Icon.ID=o.ID,e.category.Icon.Filename=o.imageURL.replace(/^\//,""),e.category.Icon.IsCustom=!0);var t=_.findIndex(s.Categories,{ID:e.category.ID});C(),e.category.Cents=d,t===-1?s.Categories.push(e.category):angular.copy(e.category,s.Categories[t]),a.close(s)}null===y&&(y=g.create()),e.category=y,e.category.Period||(e.category.Period=n.BUDGET_PERIODS[n.DEFAULT_BUDGET_PERIOD]),e.initialPeriod=e.category.Period,e.category.Cents||(e.category.Cents=new BigNumber(0)),e.category.newCategoryImage=null,e.category.newCategoryImagePreview=null;var d=_.clone(e.category.Cents);e.periods=n.BUDGET_PERIODS,e.profile=i.get(),e.siteConfig=l,e.placeholder=n.CATEGORY_TITLE_PLACEHOLDER,e.getIconPath=g.getIconPath,e.removeCategory=function(){r.areYouSureModal().then(function(e){e&&(s.Categories.splice(_.findIndex(s.Categories,{ID:y.ID}),1),a.close(s))})};var C=e.$watch("category.Cents",function(o){o&&(d=c.convert(o,e.initialPeriod,e.category.Period))});e.saveCategory=function(){if((!e.category.Cents||e.category.Cents.lessThan(0)||e.category.Cents.greaterThan(Number.MAX_SAFE_INTEGER||n.IE_MAX_SAFE_INTEGER))&&(d=new BigNumber(0)),e.category.newCategoryImage)return i.uploadBudgetImage(e.category.newCategoryImage).then(function(o){return o&&o.data.imageURL?(delete e.category.newCategoryImage,u(o.data),void a.close(s)):t.reject("Can't upload image.")}).catch(function(e){o.error(e)});u(),a.close(s)},e.cancelCategory=function(){a.dismiss("cancel")},e.$watch("category.Period",function(e,o){d=c.convert(d,o,e)})}])}();