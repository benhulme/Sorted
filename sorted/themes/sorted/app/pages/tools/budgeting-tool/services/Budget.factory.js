!function(){"use strict";angular.module("budgetingTool").factory("Budget",["$log","$q","$timeout","$window","Alert","budgetingToolConfig","calculatorApi","budgetConverter",function(t,e,n,r,a,o,u,i){function c(){A=!0}function l(){A=!1,h=!1,globalState.dirty=!1}function g(){return angular.copy({IncomeStreams:[],Categories:[],Period:o.BUDGET_PERIODS[o.DEFAULT_BUDGET_PERIOD]},b),b}function s(){angular.copy({},b),angular.copy({},v)}function d(t){return u.del(t||v)}function f(){return _.isEmpty(b)?u.get(o.CALC_ID).then(function(t){return t?(angular.copy(t,v),angular.copy(i.process(angular.fromJson(t.Data)),b),h=!1,globalState.dirty=!1):(h=!0,globalState.dirty=!0),b}):b}function y(){if(A)return _.isEmpty(v)?u.get(o.CALC_ID).then(function(t){return t?e.reject({calculator:t}):u.save(o.CALC_ID,b).then(function(t){return t&&200!==t.status?e.reject():(l(),u.get(o.CALC_ID).then(function(t){angular.copy(t,v)}))})}):u.update(v,b)}function p(t){return d(t).then(y).then(function(){l(),a.replaced()})}function C(){return s(),f().then(function(){l(),a.retained()})}function D(t){h=!0,globalState.dirty=!0;var e=_.findIndex(b.MasterCategories,{ID:t.ID});angular.copy(t,b.MasterCategories[e])}function I(t){h=!0,globalState.dirty=!0,b.MasterCategories.splice(_.findIndex(b.MasterCategories,{ID:t}),1)}function m(){return A}function S(t){h=!0,globalState.dirty=!0,b.Title=t.Title,angular.copy(t.Period,b.Period),angular.copy(t.IncomeStreams,b.IncomeStreams)}var b={},v={},A=!1,h=!1;return{budget:b,clear:s,create:g,del:d,deleteMasterCategory:I,isDirty:function(){return h},setDirty:function(){h=!0},endSaveAttempt:l,get:f,keepCurrent:C,overwrite:p,save:y,startSaveAttempt:c,saveInProgress:m,updateHeaderFields:S,updateMasterCategory:D}}])}();