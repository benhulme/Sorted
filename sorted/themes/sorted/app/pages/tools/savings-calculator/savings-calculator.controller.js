!function(){"use strict";angular.module("sorted").controller("SavingsCalculatorController",["$scope","siteConfig","SavingsCalculatorModel","$window","$routeParams","isLoggedIn","pageData","calcData","calcService","$analytics",function(t,a,e,l,o,r,c,n,i,u){function d(a){var e="Term for ";return e+=t.getDurationDesc(a)}function s(t,e){var l=e.hasResult(),o=[],r=[],c=[],n=_.merge({},t.options);if(l){o.push(e.$attributes.initial_savings),o.push(e.$attributes.type?e.result.$attributes.total_saved-e.result.$attributes.interest:e.result.$attributes.contributions),r.push(0),r.push(e.result.$attributes.interest);var i=moment(e.$attributes.starting,a.DATE_FORMAT),u=moment(e.$attributes.ending,a.DATE_FORMAT),s=moment.duration(u.diff(i));c.push(e.$attributes.type?i.format("ll"):"Now"),c.push(e.$attributes.type?u.format("ll"):_.capitalize(s.humanize(!0))),_.merge(n,{series:[{name:"Amount deposited",data:o},{name:"Compound interest",data:r}],categoryAxis:{title:{text:d(e)},categories:c}})}return n}t.siteConfig=a,t.data=c.data[0],t.calculator=n.data,t.model=function(){var a=[],o=new l.SortedCalculator_Savings;return _.forEach(t.calculator.models,function(t){var e={};_.forEach(t.fields,function(t){t.calcModel&&(e[t.calcModel]=t.value)}),_.merge(e,_.pick(t,["unique","name","id","type"])),a.push(e)}),new e({models:a,CalcID:t.calculator.CalcID},{parse:!0,calculator:o})}(),t.resultsInteraction=!1,t.interaction=!1,t.model.collection.currentType=0,t.hasResult=function(){return t.model.hasResult()},t.getDurationDesc=function(t){var e="";if(0===t.$attributes.type)e+=t.$attributes.regular_duration_amount,e+=" ",e+=t.$attributes.regular_duration_amount_type;else{var l=moment(t.$attributes.ending,a.DATE_FORMAT),o=moment(t.$attributes.starting,a.DATE_FORMAT),r=o.diff(l);e+=moment.duration(r).humanize()}return e},t.$watch("model.collection.currentType",function(){t.currentModel=t.model.collection.get(t.model.collection.currentType),t.currentNudge=t.calculator.nudge[t.model.collection.currentType],t.$broadcast("chart:draw",s(t.calculator.chart,t.currentModel))}),t.model.collection.on("change",function(a){t.interaction||(u.eventTrack("startinteraction",{category:"calculators",label:"savings"}),t.interaction=!0),a.calculate().hasResult()&&(t.resultsInteraction||(u.eventTrack("resultscalculated",{category:"calculators",label:"savings"}),t.resultsInteraction=!0),t.$broadcast("chart:draw",s(t.calculator.chart,a)))}),t.$on("chart:ready",function(){t.$broadcast("chart:draw",s(t.calculator.chart,t.model.collection.get(t.calculator.controls[0].value)))}),t.$on("save:calc",function(a,e){var l=i.prepareCollection(t.model.collection),o={CalcID:t.data.CalcID,Data:l,Title:e};t.calcTitle=e,t.loadedId?(o.ID=t.loadedId,i.update(o,t.loadedId).then(t.calcSaved,t.calcSavedFailed)):i.save(o).then(t.calcSaved,t.calcSavedFailed)}),t.calcSaved=function(a){angular.element("#save-as-modal").modal("hide"),t.loadId=a.data.ID},t.calcSavedFailed=function(t){console.error("failed ",t)},t.loadCalc=function(a){i.loadCollection(t.model.collection,a.data.data.Data),a.data.data.Data[0].result.length},t.loadCalcFailed=function(t){console.error("failed ",t)},o.id&&r&&(t.loadedId=o.id,i.get(t.loadedId).then(t.loadCalc,t.loadCalcFailed))}])}();